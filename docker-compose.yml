version: '2.1'
services:
  elasticsearch:
    image: elasticsearch:5.3
    container_name: elasticsearch
    healthcheck:
        test: ["CMD-SHELL", "curl --silent --fail localhost:9200/_cluster/health || exit 1"]
        interval: 30s
        timeout: 30s
        retries: 3
    environment:
      - "ES_JAVA_OPTS=-Xmx2g -Xms2g"
      - bootstrap.memory_local=true
      - cluster.name=adlp-cluster
    ports:
      - 19200:9200
      - 19300:9300
    networks:
      - deploy_network

  kibana:
    image: kibana:5.3
    container_name: kibana
    depends_on:
      elasticsearch:
          condition: service_healthy
    ports:
     - "5601:5601"
    environment:
     - ELASTICSEARCH_URL=http://elasticsearch:9200
     - XPACK_MONITORING_ENABLED=false
    networks:
     - deploy_network

  indexer:
    container_name: indexer
    build: indexer/
    restart: always
    networks:
      - deploy_network
    depends_on:
      elasticsearch:
          condition: service_healthy

#  dashboard:
#    image: dashboard
#    volumes:
#      - .:/code
#    build:
#      context: .
#      dockerfile: ./dashboard/Dockerfile
#    restart: always
#    networks: [deploy_network]
#    environment:
#      - PORT=8050
#      - HOST=0.0.0.0
#    ports:
#      - "${DASHBOARD_PORT}:8050"
#    depends_on:
#      - elasticsearch
#      - kibana
#
networks:
  deploy_network: